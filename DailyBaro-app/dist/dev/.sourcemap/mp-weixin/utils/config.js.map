{"version":3,"file":"config.js","sources":["utils/config.js"],"sourcesContent":["// 环境配置\nconst ENV = {\n\t// 开发环境\n\tdevelopment: {\n\t\t// 注意：微信小程序无法访问 localhost，需要使用本机IP地址\n\t\t// 你的本机IP是: 172.20.10.4\n\t\t// 如果要在本地测试，请确保你的服务运行在 172.20.10.4:8000\n\t\tBASE_URL: 'http://172.20.10.4:8000', // 网关地址（使用本机IP）\n\t\tNLP_SERVICE_URL: 'http://172.20.10.4:5001', // 本地NLP服务地址\n\t\tNLP_PYTHON_URL: 'http://172.20.10.4:5001', // 本地Python NLP服务地址\n\t\tDEBUG: true,\n\t\t// 备用网关地址（如果本地服务不可用）\n\t\tFALLBACK_URL: 'http://172.20.10.4:8000'\n\t},\n\t// 生产环境\n\tproduction: {\n\t\tBASE_URL: 'https://dailybaro.cn', // 生产环境网关地址（HTTPS）\n\t\tNLP_SERVICE_URL: 'https://dailybaro.cn/api/emotion', // 通过网关访问NLP服务\n\t\tNLP_PYTHON_URL: 'https://dailybaro.cn:5000', // 生产环境Python服务地址（如果使用）\n\t\tDEBUG: false,\n\t\tFALLBACK_URL: 'https://dailybaro.cn'\n\t}\n}\n\n// 当前环境：生产环境使用云服务器\n// 如需本地调试，改为 'development'\n// 注意：修改后需要重新编译小程序才能生效！\nconst currentEnv = 'production'\n\n// 导出配置\nexport const config = ENV[currentEnv]\n\n// 开发环境特殊配置\nexport const isDev = currentEnv === 'development'\n\n// 微信小程序开发工具配置\nexport const wxDevConfig = {\n\t// 开发工具中忽略域名校验\n\tignoreDomainCheck: isDev,\n\t// 开发工具中忽略TLS版本校验\n\tignoreTLSVersion: isDev,\n\t// 开发工具中忽略HTTPS证书校验\n\tignoreHTTPSCertificate: isDev\n}\n\n// 网关健康检查\nexport const checkGatewayHealth = async () => {\n\t// 开发环境直接返回本地地址，避免复杂的健康检查\n\tif (isDev) {\n\t\tconsole.log('✅ 开发环境使用本地网关:', config.BASE_URL)\n\t\tconsole.log('✅ 当前环境:', currentEnv)\n\t\treturn config.BASE_URL\n\t}\n\t\n\ttry {\n\t\t// 生产环境才进行健康检查\n\t\t// 注意：小程序端可能无法直接访问 /actuator/health，改用根路径或简单路径\n\t\tconst healthUrl = config.BASE_URL + (config.BASE_URL.includes('localhost') ? '/actuator/health' : '')\n\t\tconst response = await uni.request({\n\t\t\turl: healthUrl || config.BASE_URL,\n\t\t\tmethod: 'GET',\n\t\t\ttimeout: 5000,\n\t\t\t// 小程序端需要忽略 SSL 证书验证（仅开发环境）\n\t\t\tsslVerify: isDev\n\t\t})\n\t\t\n\t\tif (response.statusCode === 200 || response.statusCode === 404) {\n\t\t\t// 200 表示健康检查成功，404 可能是路径不存在但服务可用\n\t\t\tconsole.log('✅ 云服务器网关正常')\n\t\t\treturn config.BASE_URL\n\t\t}\n\t} catch (error) {\n\t\tconsole.log('❌ 云服务器网关不可用:', error.message || error)\n\t\t// 不立即返回，继续尝试备用地址\n\t}\n\t\n\t// 如果云服务器不可用，尝试备用地址\n\tif (config.FALLBACK_URL) {\n\t\ttry {\n\t\t\tconst response = await uni.request({\n\t\t\t\turl: config.FALLBACK_URL + '/actuator/health',\n\t\t\t\tmethod: 'GET',\n\t\t\t\ttimeout: 5000\n\t\t\t})\n\t\t\t\n\t\t\tif (response.statusCode === 200) {\n\t\t\t\tconsole.log('✅ 备用网关正常')\n\t\t\t\treturn config.FALLBACK_URL\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log('❌ 备用网关也不可用:', error)\n\t\t}\n\t}\n\t\n\tconsole.log('❌ 所有网关都不可用，使用默认配置')\n\treturn config.BASE_URL\n}\n\n// NLP服务健康检查\nexport const checkNlpServiceHealth = async () => {\n\ttry {\n\t\t// 首先尝试Java服务\n\t\tconst response = await uni.request({\n\t\t\turl: config.NLP_SERVICE_URL + '/actuator/health',\n\t\t\tmethod: 'GET',\n\t\t\ttimeout: 5000\n\t\t})\n\t\t\n\t\tif (response.statusCode === 200) {\n\t\t\tconsole.log('✅ Java NLP服务正常')\n\t\t\treturn config.NLP_SERVICE_URL\n\t\t}\n\t} catch (error) {\n\t\tconsole.log('❌ Java NLP服务不可用:', error)\n\t}\n\t\n\t// 如果Java服务不可用，尝试Python服务\n\tif (isDev && config.NLP_PYTHON_URL) {\n\t\ttry {\n\t\t\tconst response = await uni.request({\n\t\t\t\turl: config.NLP_PYTHON_URL + '/health',\n\t\t\t\tmethod: 'GET',\n\t\t\t\ttimeout: 5000\n\t\t\t})\n\t\t\t\n\t\t\tif (response.statusCode === 200) {\n\t\t\t\tconsole.log('✅ Python NLP服务正常，使用备用地址')\n\t\t\t\treturn config.NLP_PYTHON_URL\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log('❌ Python NLP服务也不可用:', error)\n\t\t}\n\t}\n\t\n\tconsole.log('❌ 所有NLP服务都不可用，使用默认配置')\n\treturn config.NLP_SERVICE_URL\n}\n\nexport default config\n"],"names":["uni"],"mappings":";;AACA,MAAM,MAAM;AAAA;AAAA,EAEX,aAAa;AAAA;AAAA;AAAA;AAAA,IAIZ,UAAU;AAAA;AAAA,IACV,iBAAiB;AAAA;AAAA,IACjB,gBAAgB;AAAA;AAAA,IAChB,OAAO;AAAA;AAAA,IAEP,cAAc;AAAA,EAChB;AAAA;AAAA,EAEC,YAAY;AAAA,IACX,UAAU;AAAA;AAAA,IACV,iBAAiB;AAAA;AAAA,IACjB,gBAAgB;AAAA;AAAA,IAChB,OAAO;AAAA,IACP,cAAc;AAAA,EAChB;AACA;AAKA,MAAM,aAAa;AAGP,MAAC,SAAS,IAAI,UAAU;AAG7B,MAAM,QAAQ,eAAe;AAaxB,MAAC,qBAAqB,YAAY;AAQ7C,MAAI;AAGH,UAAM,YAAY,OAAO,YAAY,OAAO,SAAS,SAAS,WAAW,IAAI,qBAAqB;AAClG,UAAM,WAAW,MAAMA,cAAAA,MAAI,QAAQ;AAAA,MAClC,KAAK,aAAa,OAAO;AAAA,MACzB,QAAQ;AAAA,MACR,SAAS;AAAA;AAAA,MAET,WAAW;AAAA,IACd,CAAG;AAED,QAAI,SAAS,eAAe,OAAO,SAAS,eAAe,KAAK;AAE/DA,oBAAAA,MAAA,MAAA,OAAA,yBAAY,YAAY;AACxB,aAAO,OAAO;AAAA,IACf;AAAA,EACD,SAAS,OAAO;AACfA,kBAAAA,MAAA,MAAA,OAAA,yBAAY,gBAAgB,MAAM,WAAW,KAAK;AAAA,EAEnD;AAGyB;AACxB,QAAI;AACH,YAAM,WAAW,MAAMA,cAAAA,MAAI,QAAQ;AAAA,QAClC,KAAK,OAAO,eAAe;AAAA,QAC3B,QAAQ;AAAA,QACR,SAAS;AAAA,MACb,CAAI;AAED,UAAI,SAAS,eAAe,KAAK;AAChCA,sBAAAA,MAAA,MAAA,OAAA,yBAAY,UAAU;AACtB,eAAO,OAAO;AAAA,MACf;AAAA,IACD,SAAS,OAAO;AACfA,oBAAAA,MAAA,MAAA,OAAA,yBAAY,eAAe,KAAK;AAAA,IACjC;AAAA,EACD;AAEAA,gBAAAA,MAAA,MAAA,OAAA,yBAAY,mBAAmB;AAC/B,SAAO,OAAO;AACf;;;"}